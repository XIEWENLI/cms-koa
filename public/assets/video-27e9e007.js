import{_ as M,l as O,r as n,aa as W,o as l,c as f,ab as C,ac as V,ad as g,a as c,w as p,X as $,s as h,ae as P,V as D,af as G,b as _,d as x}from"./index-ccedb79d.js";import{E as K,P as Q,a as Y,A as Z,b as ee,U as ae}from"./Upload-9cc6e3e1.js";import{B as te}from"./index-b02c297f.js";import"./use-placeholder-46a67666.js";import"./use-route-e010548b.js";const se={class:"video"},oe={key:0,class:"content"},ne=["src","onClick"],le={style:{display:"flex","justify-content":"space-between","margin-top":"0.2rem"}},ue={key:1},ce=["src"],ie=["src"],de={__name:"video",setup(re){let i=O.getCache("userInfo2");i=i===void 0?void 0:JSON.parse(i);let I=i.id,R=i.username,B=i.token;const U=n(".mp4"),w=n(),k=n(!1),E=e=>{w.value=e,k.value=!0},S=n(),y=n(!1),A=e=>{S.value=e,y.value=!0};(async()=>{const e=await $.get({url:"/file/getFileInfo",params:{type:"video",tableName:"file",web:1}});e.data.status||h(e.data.message),F.value=e.data.message.length})();let u=n([]);const v=async(e=10,a=0)=>{u.value=[];const s=await $.get({url:"/file/getFileInfo",params:{type:"video",limit:e,offset:a,web:1}});if(!s.data.status){h(s.data.message);return}s.data.message.forEach(o=>{o.user_id===I&&(o.src=`${P}/file/downloadFile?file_id=${o.id}&token=${B}`,u.value.push(o))})};v();const m=n(1),F=n(1),L=e=>{u.value=[],v(10,(e-1)*10)},d=n(!1),q=()=>{setTimeout(()=>{h({type:"success",message:"刷新成功~"}),u.value=[],v(10,(m.value-1)*10),d.value=!1},1e3)},z=async({id:e,fileName:a,type:s,user_id:o})=>{let b=a+"."+s.split("/")[1];const r=document.createElement("a");r.download="xiazai",r.href=`${P}/file/downloadFile?file_id=${e}&user_id=${o}&fileName=${b}&token=${B}`,r.click()},T=async({id:e})=>{let a="upload/uploadVideo/videos";const s=await $.get({url:"/file/deleteFile",params:{file_id:e,userName:R,url:a}});s.data.status?(v(10,(m.value-1)*10),h({type:"success",message:s.data.message})):h(s.data.message)},X=()=>{v(10,(m.value-1)*10),y.value=!1};return(e,a)=>{const s=K,o=te,b=Q,r=W,j=Y,H=Z,J=ee;return l(),f("div",se,[C(u).length<=0?(l(),V(s,{key:0,description:"数据为空~"})):g("",!0),c(j,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=t=>d.value=t),onRefresh:q},{default:p(()=>[d.value?g("",!0):(l(),f("div",oe,[(l(!0),f(D,null,G(C(u),t=>(l(),f("ul",{key:t.id},[_("li",null,[_("div",null,[_("video",{width:"160",height:"120",src:t.src,onClick:N=>E(t.src)},null,8,ne)]),_("div",le,[c(o,{type:"default",size:"small",onClick:N=>z(t)},{default:p(()=>[x("下载")]),_:2},1032,["onClick"]),c(o,{type:"warning",size:"small",onClick:N=>T(t)},{default:p(()=>[x("删除")]),_:2},1032,["onClick"])])])]))),128))])),C(u).length>0?(l(),f("div",ue,[d.value?g("",!0):(l(),V(b,{key:0,class:"fy",onChange:L,modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=t=>m.value=t),"total-items":F.value,"items-per-page":10},null,8,["modelValue","total-items"]))])):g("",!0),c(r,{show:k.value,"onUpdate:show":a[1]||(a[1]=t=>k.value=t)},{default:p(()=>[_("video",{style:{width:"20rem"},src:w.value,controls:"controls"},[_("source",{src:w.value,type:"video/mp4"},null,8,ie),x(" 您的浏览器不支持 HTML5 video 标签。 ")],8,ce)]),_:1},8,["show"]),c(r,{show:y.value,"onUpdate:show":a[2]||(a[2]=t=>y.value=t)},{default:p(()=>[c(ae,{accept:U.value,onAgainRequest:X},null,8,["accept"])]),_:1},8,["show"])]),_:1},8,["modelValue"]),d.value?g("",!0):(l(),V(J,{key:1,class:"upload"},{default:p(()=>[c(H,{type:"danger",text:"上传",onClick:A})]),_:1}))])}}},he=M(de,[["__scopeId","data-v-b04325e7"]]);export{he as default};
