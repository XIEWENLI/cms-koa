import{r as C,J as q,X as x,bT as D,bS as T,aD as j,o as E,c as $,$ as F,b as V,w as M,N as R,aQ as X,U as H,d as J,E as z,bU as O,bV as P}from"./index.20087b12.js";import{E as Q,a as W}from"./el-input.489bb2be.js";import{a as G,b as K}from"./Input.386424a6.js";import"./el-popper.5095a660.js";import{_ as Y}from"./_plugin-vue_export-helper.cdc0426e.js";var N={exports:{}};(function(A,L){(function(B){A.exports=B()})(function(B){var _=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function h(s,a){var t=s[0],e=s[1],n=s[2],r=s[3];t+=(e&n|~e&r)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[1]-389564586|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[2]+606105819|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[6]-1473231341|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[10]-42063|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&r)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&n)+a[13]-40341101|0,r=(r<<12|r>>>20)+t|0,n+=(r&t|~r&e)+a[14]-1502002290|0,n=(n<<17|n>>>15)+r|0,e+=(n&r|~n&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&r|n&~r)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[11]+643717713|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[10]+38016083|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[15]-660478335|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[3]-187363961|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&r|n&~r)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&n|e&~n)+a[2]-51403784|0,r=(r<<9|r>>>23)+t|0,n+=(r&e|t&~e)+a[7]+1735328473|0,n=(n<<14|n>>>18)+r|0,e+=(n&t|r&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^r)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[11]+1839030562|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[7]-155497632|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[0]-358537222|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[3]-722521979|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^r)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^n)+a[12]-421815835|0,r=(r<<11|r>>>21)+t|0,n+=(r^t^e)+a[15]+530742520|0,n=(n<<16|n>>>16)+r|0,e+=(n^r^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~r))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[14]-1416354905|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[10]-1051523|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[15]-30611744|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[6]-1560198380|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~r))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~n))+a[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,n+=(t^(r|~e))+a[2]+718787259|0,n=(n<<15|n>>>17)+r|0,e+=(r^(n|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+n|0,s[0]=t+s[0]|0,s[1]=e+s[1]|0,s[2]=n+s[2]|0,s[3]=r+s[3]|0}function S(s){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=s.charCodeAt(t)+(s.charCodeAt(t+1)<<8)+(s.charCodeAt(t+2)<<16)+(s.charCodeAt(t+3)<<24);return a}function U(s){var a=[],t;for(t=0;t<64;t+=4)a[t>>2]=s[t]+(s[t+1]<<8)+(s[t+2]<<16)+(s[t+3]<<24);return a}function w(s){var a=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,f,p,l;for(e=64;e<=a;e+=64)h(t,S(s.substring(e-64,e)));for(s=s.substring(e-64),n=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=s.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(h(t,r),e=0;e<16;e+=1)r[e]=0;return f=a*8,f=f.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(f[2],16),l=parseInt(f[1],16)||0,r[14]=p,r[15]=l,h(t,r),t}function I(s){var a=s.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,r,f,p,l;for(e=64;e<=a;e+=64)h(t,U(s.subarray(e-64,e)));for(s=e-64<a?s.subarray(e-64):new Uint8Array(0),n=s.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)r[e>>2]|=s[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(h(t,r),e=0;e<16;e+=1)r[e]=0;return f=a*8,f=f.toString(16).match(/(.*?)(.{0,8})$/),p=parseInt(f[2],16),l=parseInt(f[1],16)||0,r[14]=p,r[15]=l,h(t,r),t}function m(s){var a="",t;for(t=0;t<4;t+=1)a+=_[s>>t*8+4&15]+_[s>>t*8&15];return a}function i(s){var a;for(a=0;a<s.length;a+=1)s[a]=m(s[a]);return s.join("")}i(w("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function s(a,t){return a=a|0||0,a<0?Math.max(a+t,0):Math.min(a,t)}ArrayBuffer.prototype.slice=function(a,t){var e=this.byteLength,n=s(a,e),r=e,f,p,l,d;return t!==B&&(r=s(t,e)),n>r?new ArrayBuffer(0):(f=r-n,p=new ArrayBuffer(f),l=new Uint8Array(p),d=new Uint8Array(this,n,f),l.set(d),p)}}();function y(s){return/[\u0080-\uFFFF]/.test(s)&&(s=unescape(encodeURIComponent(s))),s}function c(s,a){var t=s.length,e=new ArrayBuffer(t),n=new Uint8Array(e),r;for(r=0;r<t;r+=1)n[r]=s.charCodeAt(r);return a?n:e}function b(s){return String.fromCharCode.apply(null,new Uint8Array(s))}function g(s,a,t){var e=new Uint8Array(s.byteLength+a.byteLength);return e.set(new Uint8Array(s)),e.set(new Uint8Array(a),s.byteLength),t?e:e.buffer}function u(s){var a=[],t=s.length,e;for(e=0;e<t-1;e+=2)a.push(parseInt(s.substr(e,2),16));return String.fromCharCode.apply(String,a)}function o(){this.reset()}return o.prototype.append=function(s){return this.appendBinary(y(s)),this},o.prototype.appendBinary=function(s){this._buff+=s,this._length+=s.length;var a=this._buff.length,t;for(t=64;t<=a;t+=64)h(this._hash,S(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},o.prototype.end=function(s){var a=this._buff,t=a.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)n[e>>2]|=a.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),r=i(this._hash),s&&(r=u(r)),this.reset(),r},o.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},o.prototype.setState=function(s){return this._buff=s.buff,this._length=s.length,this._hash=s.hash,this},o.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},o.prototype._finish=function(s,a){var t=a,e,n,r;if(s[t>>2]|=128<<(t%4<<3),t>55)for(h(this._hash,s),t=0;t<16;t+=1)s[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),r=parseInt(e[1],16)||0,s[14]=n,s[15]=r,h(this._hash,s)},o.hash=function(s,a){return o.hashBinary(y(s),a)},o.hashBinary=function(s,a){var t=w(s),e=i(t);return a?u(e):e},o.ArrayBuffer=function(){this.reset()},o.ArrayBuffer.prototype.append=function(s){var a=g(this._buff.buffer,s,!0),t=a.length,e;for(this._length+=s.byteLength,e=64;e<=t;e+=64)h(this._hash,U(a.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(a.buffer.slice(e-64)):new Uint8Array(0),this},o.ArrayBuffer.prototype.end=function(s){var a=this._buff,t=a.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,r;for(n=0;n<t;n+=1)e[n>>2]|=a[n]<<(n%4<<3);return this._finish(e,t),r=i(this._hash),s&&(r=u(r)),this.reset(),r},o.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},o.ArrayBuffer.prototype.getState=function(){var s=o.prototype.getState.call(this);return s.buff=b(s.buff),s},o.ArrayBuffer.prototype.setState=function(s){return s.buff=c(s.buff,!0),o.prototype.setState.call(this,s)},o.ArrayBuffer.prototype.destroy=o.prototype.destroy,o.ArrayBuffer.prototype._finish=o.prototype._finish,o.ArrayBuffer.hash=function(s,a){var t=I(new Uint8Array(s)),e=i(t);return a?u(e):e},o})})(N);const Z=N.exports;const k=A=>(O("data-v-cd5354f4"),A=A(),P(),A),ee={class:"upload"},te=["accept"],re=k(()=>F("progress",{value:"0",max:"100",style:{display:"none"}},null,-1)),ne={__name:"Upload",props:["accept"],emits:["againRequest"],setup(A,{emit:L}){const B=A,_=C(""),h=C(""),S=C([]);let U;const w=()=>{if(!h.value||!_.value){z.error("\u6587\u4EF6\u540D\u6216\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A~");return}U()};return q(()=>{const m=document.querySelector("#file"),i=document.querySelector("progress");U=()=>{m.click()},m.addEventListener("change",()=>{const c=Array.from(m.files);if(c.length>3){showNotify("\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC73\u4E2A~"),c=[];return}let b=c[0].size,g=0;i.style.display="block",c.forEach(u=>{const o=u.type.split("/")[1],s=u.type;console.log("1\u3001\u6587\u4EF6\u8BFB\u53D6~");const a=new FileReader;a.readAsArrayBuffer(u),a.onload=async t=>{console.log("2\u3001\u83B7\u53D6hash\u503C~");const e=y(t.target.result);console.log("3\u3001\u5F00\u59CB\u5207\u7247~");let n=5*1024*1024;u.size/n>100&&(n=Math.ceil(u.size/100));let r=[],f=0;for(let l=0;l<u.size;l+=n)r.push({hash:`${e}_${f}`,chunk:u.slice(l,l+n)}),f++;try{const{data:l}=await x.get({url:"/file/getFileSlice",params:{hash:e,suffix:o}});r=r.filter(d=>!l.includes(d.hash))}catch(l){console.log("\u83B7\u53D6\u5DF2\u4E0A\u4F20\u5207\u7247\u5931\u8D25\u7684\u539F\u56E0\uFF1A"+l.response.data)}console.log("4\u3001\u4E0A\u4F20\u5207\u7247~");let p=[];c.length===1?i.max=r.length:i.max=c.length,r.forEach(l=>{let d=new FormData;d.append("file",l.chunk),d.append("hash",l.hash),d.append("suffix",o),p.push(D.post(`${T}/file/uploadFileSlice?token=${j().userInfo.token}`,d).then(v=>{c.length===1&&(g+=1,i.value=g)}).catch(v=>{console.log("\u5207\u7247\u4E0A\u4F20\u5931\u8D25\u7684\u539F\u56E0\uFF1A"+v.response.data)}))}),Promise.all(p).then(l=>{c.length>1&&(g+=1,i.value=g);let d=_.value;x.get({url:`/file/mergeFile?user_id=${h.value}`,params:{hash:e,fileName:d,suffix:o,type:s,len:f,fileSize:b}}).then(v=>{_.value="",h.value="",(i.value===i.max||r.length===0)&&(console.log("5\u3001\u4E0A\u4F20\u5207\u7247\u6210\u529F~"),i.value=0,i.max=100,i.style.display="none"),L("againRequest"),console.log(v.data.file)}).catch(v=>{console.log("\u5408\u5E76\u5207\u7247\u5931\u8D25\u7684\u539F\u56E0\uFF1A"+v.response.data)})}).catch(l=>{console.log("5\u3001\u4E0A\u4F20\u5931\u8D25~")})}})});function y(c){const b=new Z.ArrayBuffer;return b.append(c),b.end()}}),(async(m=5e3,i=0)=>{const y=await x.get({url:"/user/getUsers",params:{limit:m,offset:i}}),c=await x.get({url:"/user/getUserById",params:{user_id:1}});if(!y.data.status){z.error(y.data.message);return}S.value=[...c.data.message,...y.data.message]})(),(m,i)=>{const y=Q,c=G,b=K,g=W;return E(),$(R,null,[F("div",ee,[V(y,{modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=u=>_.value=u),placeholder:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D~"},null,8,["modelValue"]),V(b,{style:{"margin-left":"10px"},modelValue:h.value,"onUpdate:modelValue":i[1]||(i[1]=u=>h.value=u),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237~"},{default:M(()=>[(E(!0),$(R,null,X(S.value,u=>(E(),H(c,{key:u.id,label:u.username,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),F("input",{type:"file",id:"file",style:{display:"none"},accept:B.accept,multiple:""},null,8,te),V(g,{style:{"margin-left":"10px"},type:"primary",onClick:w},{default:M(()=>[J("\u4E0A\u4F20")]),_:1})]),re],64)}}},ue=Y(ne,[["__scopeId","data-v-cd5354f4"]]);export{ue as U};
