import{e as ae,n as V,t as T,m as M,f as te,r as l,q as oe,g as ne,j as N,x as se,K as le,a6 as re,a7 as ie,M as ce,L as O,a as n,a8 as ue,a9 as de,S as X,I as fe,k as me,_ as ve,l as ge,aa as _e,o as h,c as C,ab as R,ac as U,ad as L,w as b,X as j,s as $,ae as J,V as he,af as pe,b as F,d as K}from"./index-ccedb79d.js";import{E as we,P as ye,a as ke,A as be,b as Pe,U as Ie}from"./Upload-9cc6e3e1.js";import{B as xe}from"./index-b02c297f.js";import"./use-placeholder-46a67666.js";import"./use-route-e010548b.js";const[Ce,P]=ae("image"),Le={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:V,height:V,radius:V,lazyLoad:Boolean,iconSize:V,showError:T,errorIcon:M("photo-fail"),iconPrefix:String,showLoading:T,loadingIcon:M("photo")};var $e=te({name:Ce,props:Le,emits:["load","error"],setup(a,{emit:i,slots:y}){const p=l(!1),c=l(!0),u=l(),{$Lazyload:m}=oe().proxy,I=ne(()=>{const e={width:N(a.width),height:N(a.height)};return se(a.radius)&&(e.overflow="hidden",e.borderRadius=N(a.radius)),e});le(()=>a.src,()=>{p.value=!1,c.value=!0});const B=e=>{c.value&&(c.value=!1,i("load",e))},S=()=>{const e=new Event("load");Object.defineProperty(e,"target",{value:u.value,enumerable:!0}),B(e)},w=e=>{p.value=!0,c.value=!1,i("error",e)},z=(e,k,f)=>f?f():n(fe,{name:e,size:a.iconSize,class:k,classPrefix:a.iconPrefix},null),q=()=>{if(c.value&&a.showLoading)return n("div",{class:P("loading")},[z(a.loadingIcon,P("loading-icon"),y.loading)]);if(p.value&&a.showError)return n("div",{class:P("error")},[z(a.errorIcon,P("error-icon"),y.error)])},d=()=>{if(p.value||!a.src)return;const e={alt:a.alt,class:P("img"),style:{objectFit:a.fit,objectPosition:a.position}};return a.lazyLoad?ue(n("img",X({ref:u},e),null),[[de("lazy"),a.src]]):n("img",X({ref:u,src:a.src,onLoad:B,onError:w},e),null)},v=({el:e})=>{const k=()=>{e===u.value&&c.value&&S()};u.value?k():O(k)},g=({el:e})=>{e===u.value&&!p.value&&w()};return m&&re&&(m.$on("loaded",v),m.$on("error",g),ie(()=>{m.$off("loaded",v),m.$off("error",g)})),ce(()=>{O(()=>{var e;(e=u.value)!=null&&e.complete&&S()})}),()=>{var e;return n("div",{class:P({round:a.round,block:a.block}),style:I.value},[d(),q(),(e=y.default)==null?void 0:e.call(y)])}}});const Be=me($e);const Se={class:"photo"},ze={key:0,class:"content"},Ee={style:{display:"flex","justify-content":"space-between","margin-top":"0.2rem"}},Ve={key:1},Fe=["src"],Ne={__name:"photo",setup(a){let i=ge.getCache("userInfo2");i=i===void 0?void 0:JSON.parse(i);let y=i.id,p=i.username,c=i.token;const u=l(".png,.jpeg,.jpg"),m=l(),I=l(!1),B=t=>{m.value=t,I.value=!0},S=l(),w=l(!1),z=t=>{S.value=t,w.value=!0};(async()=>{const t=await j.get({url:"/file/getFileInfo",params:{type:"image",tableName:"file",web:1}});t.data.status||$(t.data.message),e.value=t.data.message.length})();let d=l([]);const v=async(t=10,o=0)=>{d.value=[];const r=await j.get({url:"/file/getFileInfo",params:{type:"image",limit:t,offset:o,web:1}});if(!r.data.status){$(r.data.message);return}r.data.message.forEach(_=>{_.user_id===y&&(_.src=`${J}/file/downloadFile?file_id=${_.id}&token=${c}`,d.value.push(_))})};v();const g=l(1),e=l(1),k=t=>{d.value=[],v(10,(t-1)*10)},f=l(!1),W=()=>{setTimeout(()=>{$({type:"success",message:"刷新成功~"}),d.value=[],v(10,(g.value-1)*10),f.value=!1},1e3)},G=async({id:t,fileName:o,type:r,user_id:_})=>{let E=o+"."+r.split("/")[1];const x=document.createElement("a");x.download="xiazai",x.href=`${J}/file/downloadFile?file_id=${t}&user_id=${_}&fileName=${E}&token=${c}`,x.click()},H=async({id:t})=>{let o="upload/uploadPhotos/photos";const r=await j.get({url:"/file/deleteFile",params:{file_id:t,userName:p,url:o}});r.data.status?(v(10,(g.value-1)*10),$({type:"success",message:r.data.message})):$(r.data.message)},Q=()=>{v(10,(g.value-1)*10),w.value=!1};return(t,o)=>{const r=we,_=Be,E=xe,x=ye,A=_e,Y=ke,Z=be,ee=Pe;return h(),C("div",Se,[R(d).length<=0?(h(),U(r,{key:0,description:"数据为空~"})):L("",!0),n(Y,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=s=>f.value=s),onRefresh:W},{default:b(()=>[f.value?L("",!0):(h(),C("div",ze,[(h(!0),C(he,null,pe(R(d),s=>(h(),C("ul",{key:s.id},[F("li",null,[F("div",null,[n(_,{width:"160",height:"120",src:s.src,onClick:D=>B(s.src)},null,8,["src","onClick"])]),F("div",Ee,[n(E,{type:"default",size:"small",onClick:D=>G(s)},{default:b(()=>[K("下载")]),_:2},1032,["onClick"]),n(E,{type:"warning",size:"small",onClick:D=>H(s)},{default:b(()=>[K("删除")]),_:2},1032,["onClick"])])])]))),128))])),R(d).length>0?(h(),C("div",Ve,[f.value?L("",!0):(h(),U(x,{key:0,class:"fy",onChange:k,modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=s=>g.value=s),"total-items":e.value,"items-per-page":10},null,8,["modelValue","total-items"]))])):L("",!0),n(A,{show:I.value,"onUpdate:show":o[1]||(o[1]=s=>I.value=s)},{default:b(()=>[F("img",{style:{width:"20rem"},src:m.value,alt:"错误"},null,8,Fe)]),_:1},8,["show"]),n(A,{show:w.value,"onUpdate:show":o[2]||(o[2]=s=>w.value=s)},{default:b(()=>[n(Ie,{accept:u.value,onAgainRequest:Q},null,8,["accept"])]),_:1},8,["show"])]),_:1},8,["modelValue"]),f.value?L("",!0):(h(),U(ee,{key:1,class:"upload"},{default:b(()=>[n(Z,{type:"danger",text:"上传",onClick:z})]),_:1}))])}}},De=ve(Ne,[["__scopeId","data-v-ad2c4861"]]);export{De as default};
